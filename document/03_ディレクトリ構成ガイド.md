# ディレクトリ構成ガイド

このドキュメントでは、Vue3 プロジェクトのディレクトリ構成と、「どこに何を置くか」のルールを説明します。

---

## プロジェクト全体構成

このプロジェクトでは、Vue2 / Vue3 で共通利用するコードを `fe-libs/` に配置し、アプリ固有のコードを `vue3-app/` に配置します。

```
repo-root/
├── fe-libs/                     # Vue2 / Vue3 共通ライブラリ
│   ├── mocks/                   # MSW モック定義（共通化）
│   │   ├── handlers/            # API ごとの handler
│   │   ├── fixtures/            # レスポンス用データ
│   │   ├── scenarios/           # handler セット（切り替え用）
│   │   └── index.ts
│   ├── types/                   # API DTO 型定義
│   │   ├── generated/           # OpenAPI から自動生成（編集禁止）
│   │   │   └── openapi.d.ts
│   │   └── index.ts
│   ├── openapi/                 # Swagger / OpenAPI 定義
│   └── scripts/                 # DTO 生成用スクリプト
│
└── vue3-app/
    ├── src/
    │   ├── assets/              # 画像・フォントなどの静的アセット
    │   ├── components/          # 汎用コンポーネント
    │   ├── domain/              # ドメインロジック（entities に相当）
    │   ├── mocks/               # MSW 初期化（アプリ固有）
    │   │   └── browser.ts       # MSW 初期化（setupWorker）
    │   ├── pages/               # 画面（ルーティング入口）
    │   ├── router/              # Vue Router 設定
    │   ├── services/            # API 呼び出しサービス
    │   ├── shared/              # 共有ユーティリティ
    │   ├── stores/              # Pinia ストア
    │   └── devtools/            # 開発用ツール
    │       └── msw-harness/     # MSW 動作確認用（dev-only）
    ├── public/
    ├── index.html
    ├── package.json
    ├── tsconfig.json
    └── vite.config.ts
```

---

## CDD 設計との対応

| CDD の概念 | ディレクトリ | 説明 |
|------------|--------------|------|
| pages | `src/pages/` | ルーティング入口 |
| widgets | `src/pages/*/` 内に配置 | 画面の骨組み |
| sections | `src/pages/*/` 内に配置 | 意味のある入力・表示の塊 |
| features/model | `src/pages/*/useXxx.ts` | 状態とロジック |
| entities | `src/domain/` | ドメインロジック |
| shared/ui | `src/components/` | 共通 UI 部品 |
| API 呼び出し | `src/services/` | API サービス層 |
| 型定義（DTO） | `fe-libs/types/` | OpenAPI から自動生成 |
| MSW モック | `fe-libs/mocks/` | Vue2/Vue3 共通 |

---

## 各ディレクトリの詳細

### src/pages/

画面ごとにフォルダを作成します。

```
src/pages/
├── items/
│   ├── ItemsListPage.vue      # ルーティング入口
│   └── useItemsList.ts        # 状態・ロジック（model）
└── wizard/
    ├── WizardPage.vue         # ルーティング入口
    ├── steps/                 # ウィザードのステップ（sections）
    │   ├── Step1.vue
    │   ├── Step2.vue
    │   └── Step3.vue
    └── useWizard.ts           # 状態・ロジック
```

**ルール：**
- 画面名のフォルダを作る（`items/`, `wizard/` など）
- ルーティング入口は `XxxPage.vue` という命名
- 状態・ロジックは `useXxx.ts` という命名
- 画面固有の sections はその画面フォルダ内に配置

---

### src/components/

アプリ全体で再利用する共通 UI 部品を配置します。

```
src/components/
├── Button/
│   ├── Button.vue
│   └── Button.stories.ts      # Storybook（あれば）
├── TextField/
│   ├── TextField.vue
│   └── TextField.stories.ts
└── Modal/
    └── Modal.vue
```

**ルール：**
- 1 コンポーネント = 1 ディレクトリ
- コンポーネント名は PascalCase
- Storybook ファイルは同じディレクトリに配置

---

### src/services/

API 呼び出しを担当するサービス層です。

```
src/services/
├── itemsService.ts
└── wizardService.ts
```

**例：**

```typescript
// services/itemsService.ts
import { http } from '@/shared/http'
import type { Item } from '@/contracts/items'

export const fetchItems = async (): Promise<Item[]> => {
  const response = await http.get('/api/items')
  return response.data
}

export const createItem = async (item: Omit<Item, 'id'>): Promise<Item> => {
  const response = await http.post('/api/items', item)
  return response.data
}
```

**ルール：**
- API エンドポイントごとにファイルを分ける
- 戻り値の型を明示する
- エラーハンドリングは呼び出し側（model）で行う

---

### src/contracts/

API のリクエスト・レスポンスの型定義（DTO）を配置します。

```
src/contracts/
├── items.ts
├── auth.ts
└── profileWizard.ts
```

**例：**

```typescript
// contracts/items.ts

/** API レスポンス: 商品一覧 */
export interface Item {
  id: string
  name: string
  price: number
  createdAt: string
}

/** API リクエスト: 商品作成 */
export interface CreateItemRequest {
  name: string
  price: number
}
```

**ルール：**
- API が返す構造をそのまま定義する
- フロントエンド都合の加工はしない
- ViewModel への変換は model 層で行う

---

### src/domain/

ドメインロジック（entities）を配置します。

```
src/domain/
├── item.ts
└── wizard.ts
```

**例：**

```typescript
// domain/item.ts

export interface ItemValidationResult {
  valid: boolean
  errors: {
    name?: string
    price?: string
  }
}

/** 商品データのバリデーション */
export const validateItem = (item: { name: string; price: number }): ItemValidationResult => {
  const errors: ItemValidationResult['errors'] = {}

  if (!item.name.trim()) {
    errors.name = '商品名は必須です'
  }

  if (item.price < 0) {
    errors.price = '価格は0以上にしてください'
  }

  return {
    valid: Object.keys(errors).length === 0,
    errors
  }
}
```

**ルール：**
- UI に依存しない
- API に依存しない
- 純関数のみ

---

### src/stores/

Pinia ストア（複数画面で共有する状態）を配置します。

```
src/stores/
├── authStore.ts
└── wizardStore.ts
```

**例：**

```typescript
// stores/wizardStore.ts
import { defineStore } from 'pinia'
import { ref } from 'vue'

export const useWizardStore = defineStore('wizard', () => {
  const currentStep = ref(1)
  const formData = ref({
    name: '',
    email: '',
    preferences: []
  })

  const nextStep = () => {
    currentStep.value++
  }

  const prevStep = () => {
    currentStep.value--
  }

  const reset = () => {
    currentStep.value = 1
    formData.value = { name: '', email: '', preferences: [] }
  }

  return { currentStep, formData, nextStep, prevStep, reset }
})
```

**ルール：**
- 複数画面で共有するデータのみ Store に置く
- 画面固有の状態は `useXxx.ts`（model）に置く
- API 呼び出しは Store に書かない（services に委譲）

---

### fe-libs/mocks/（MSW モック定義）

MSW の handler / fixture / scenario は Vue2 / Vue3 で共通利用するため、`fe-libs/mocks/` に配置します。

```
fe-libs/mocks/
├── handlers/            # API ごとの handler
│   ├── index.ts         # handler の集約
│   ├── items.handlers.ts
│   └── auth.handlers.ts
├── fixtures/            # レスポンス用データ
│   ├── items.normal.ts
│   ├── items.empty.ts
│   ├── items.large.ts
│   └── bugs/            # バグ再現用（JSON 許可）
│       └── bug-12345.items.json
├── scenarios/           # handler セット
│   └── items.scenarios.ts
└── index.ts
```

**ルール：**
- handler / fixture / scenario の **定義** は `fe-libs/mocks/` に置く
- MSW の **初期化**（`setupWorker`）は各アプリ（`vue3-app/src/mocks/`）に置く
- fixture は API レスポンスと完全一致させる（UI 都合で変えない）

### fe-libs/types/（DTO 型定義）

API の型定義（DTO）は OpenAPI（Swagger）から自動生成します。

```
fe-libs/types/
├── generated/           # 自動生成（編集禁止）
│   └── openapi.d.ts
└── index.ts             # export 集約
```

**ルール：**
- `generated/` 配下は直接編集しない
- DTO を変更したい場合は API 仕様を変更する
- UI 用の型（ViewModel）は別で定義する

### vue3-app/src/mocks/（MSW 初期化）

MSW の初期化処理はアプリ固有です。

```
vue3-app/src/mocks/
└── browser.ts           # setupWorker / worker.start
```

**ルール：**
- 初期化処理のみ配置（handler は fe-libs に）
- BP は編集不要（基盤担当が管理）

詳細は [06_MSW入門](./06_MSW入門.md) を参照してください。

---

## ファイル命名規則

| 種類 | 命名規則 | 例 |
|------|----------|-----|
| Vue コンポーネント | PascalCase | `ItemsListPage.vue` |
| Composable（useXxx） | camelCase | `useItemsList.ts` |
| サービス | camelCase + Service | `itemsService.ts` |
| ストア | camelCase + Store | `wizardStore.ts` |
| 型定義 | PascalCase | `Item`, `CreateItemRequest` |
| ハンドラー | xxx.handlers.ts | `items.handlers.ts` |
| フィクスチャ | xxx.ts | `items.ts` |

---

## 新しいファイルを作るときの判断フロー

```
何を作りたい？
    │
    ├─ 画面の入口 → src/pages/画面名/XxxPage.vue
    │
    ├─ 画面の状態・ロジック → src/pages/画面名/useXxx.ts
    │
    ├─ 画面固有の UI 部品 → src/pages/画面名/components/
    │
    ├─ 複数画面で使う UI 部品 → src/components/
    │
    ├─ API 呼び出し → src/services/xxxService.ts
    │
    ├─ ドメインロジック → src/domain/xxx.ts
    │
    ├─ 複数画面で共有する状態 → src/stores/xxxStore.ts
    │
    ├─ API モック（handler/fixture） → fe-libs/mocks/handlers/xxx.handlers.ts
    │
    └─ API 型定義（DTO） → fe-libs/types/（自動生成）
```

---

## よくある質問

### Q: widgets と sections はどこに置く？

現状のプロジェクトでは、画面フォルダ内に直接配置しています。

```
src/pages/wizard/
├── WizardPage.vue        # Page（ルーティング入口）
├── WizardWidget.vue      # Widget（骨組み）※必要に応じて
├── steps/                # Sections
│   ├── Step1.vue
│   ├── Step2.vue
│   └── Step3.vue
└── useWizard.ts          # Model
```

小規模な画面では Page と Widget を兼ねることもあります。

### Q: Store と useXxx.ts（model）の違いは？

| | Store | useXxx.ts（model） |
|---|-------|-------------------|
| スコープ | アプリ全体 | 画面固有 |
| 寿命 | アプリ終了まで | 画面離脱で破棄 |
| 用途 | 認証情報、キャッシュ | フォーム入力、UI 状態 |

### Q: contracts と domain の違いは？

| | contracts | domain |
|---|-----------|--------|
| 内容 | API の型定義（DTO） | ビジネスルール |
| 例 | `Item` インターフェース | `validateItem` 関数 |
| 依存 | API 仕様に従う | API に依存しない |

---

## 次のステップ

ディレクトリ構成を理解したら、[04_実装パターン集](./04_実装パターン集.md) で具体的なコードパターンを確認しましょう。
