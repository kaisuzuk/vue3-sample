# shared/ui と Wrapper パターン 運用ガイド

（Vueマイグレーション／CDD設計補足）

---

## 1. このドキュメントの目的

このドキュメントは、`shared/ui` で作成した共通UI部品（Buttonなど）を、

* どこまで共通化するのか
* どこからは Wrapper コンポーネントで吸収するのか

をチームで統一するための設計ガイドです。目的は以下です。

* shared/ui が壊れるのを防ぐ
* 画面ごとの都合を安全に扱えるようにする
* デザインと実装の責務を明確にする
* CDD（コンポーネント駆動開発）を破綻させない

---

## 2. 前提となる考え方

### shared/ui の役割

shared/ui は **デザインシステムの一部**です。

* 「どの画面でも同じ意味なら同じ見た目」
* 「選択肢は意味を持つ」
* 「誰が使っても破綻しない」

ことが最優先です。

---

### Wrapper コンポーネントの役割

Wrapper は **使う側（画面・widget）の都合を閉じ込める場所**です。

* レイアウトの都合
* 画面固有の例外デザイン
* 用途固定（登録・削除など）
* UI＋振る舞いのセット

を shared/ui に漏らさないための安全弁です。

---

## 3. 大原則（必ず守る）

### 原則①：shared/ui は「意味のある選択肢」だけを持つ

shared/ui に追加してよいのは、

* variant（primary / secondary / danger など）
* size（sm / md / lg など）
* loading / disabled / focus などの状態

のような **意味を持つ語彙**のみです。

数値指定（px指定）や色コード指定はしません。

---

### 原則②：レイアウトの責務は shared/ui ではない

margin / gap / width / 配置 は、**ボタン自身の責務ではなく、置く側の責務**です。
そのため、

* margin
* 横幅100%
* 右寄せ・下部固定
* toolbar内配置

などは wrapper または親コンポーネントで対応します。

---

### 原則③：画面固有の都合は wrapper に閉じ込める

「この画面だけ」「今だけ」「暫定対応」なものはshared/ui に入れません。wrapper に閉じ込めて、例外であることを明示します。

---

## 4. Wrapper で解決するべきもの（推奨）

### 1) レイアウト・配置の都合

以下はすべて wrapper（または親）で対応します。

* margin
* gap
* width
* position（fixed / sticky）
* 並び順、配置位置

理由：
これらは「ボタン自身」ではなく「周囲との関係」だからです。

---

### 2) 用途が固定されたボタン

例：

* 登録ボタン
* 保存ボタン
* 削除ボタン
* 確定ボタン

これらは

* ラベル
* variant
* size
* loading対応

がほぼ固定されるため、Wrapper コンポーネントとして切り出します。

例：
RegisterButton / DangerDeleteButton など

これにより、呼び出し側は「意味」だけを意識できます。

---

### 3) 画面固有の例外デザイン

例：

* 地図画面だけ背景に合わせて白文字にしたい
* この画面だけ padding を詰めたい
* A/Bテスト用の一時的な見た目変更

これらは shared/ui に入れず、wrapper に閉じ込めます。

理由：
全体に影響する変更ではないためです。

---

### 4) UI＋振る舞いがセットになったもの

例：

* 削除前に確認ダイアログを出す
* クリック時に補助処理が入る
* 特定のイベントだけ emit する

これらは「使い方」を固定した wrapper にするのが安全です。

---

## 5. shared/ui に入れるべきもの（推奨）

### 1) 横断的に必要な意味のある見た目

以下は shared/ui の責務です。

* primary / secondary / danger などの役割色
* solid / outline / ghost などの表現型
* sm / md / lg などのサイズ体系
* loading / disabled / focus の状態表現

理由：
同じ意味なら、どこでも同じ見た目であるべきだからです。

---

### 2) コンポーネント自身の内側の調整

以下は shared/ui 内で完結させます。

* padding（size体系の一部）
* フォントサイズ
* 角丸
* hover / active / focus の挙動
* ボタン内のアイコンと文字間隔

---

## 6. 色・padding はどちらで扱うか（よく迷う点）

### 色（color）

* 意味がある色（主操作・危険操作など）
  → shared/ui（variant）
* 場の都合で変えたい色（背景との兼ね合いなど）
  → wrapper（例外）

---

### padding

* サイズ体系としての padding（sm / md / lg）
  → shared/ui（size）
* その場だけ詰めたい／広げたい
  → wrapper（例外）

注意：
paddingを例外で触りたくなるケースが増えたら、shared/ui の size 体系が不足しているサインです。

---

## 7. 判断に迷った時のチェックリスト

次の質問に答えて判断します。

1. これはコンポーネント自身の意味か？
2. 複数画面で同じ意味で使われるか？
3. 数値指定（px指定）をしたくなっていないか？
4. この変更が全体に影響しても問題ないか？

* YES が多い → shared/ui への追加を検討
* NO が多い → wrapper で対応

---

## 8. よくあるアンチパターン（禁止）

* shared/ui に margin を持たせる
* 色やpaddingを自由指定できる props を作る
* 画面都合の調整を shared/ui に直接入れる
* wrapper を作らず、毎回 class を当てる
* 例外対応が shared/ui に蓄積される

---

## 9. チーム向け短文ルール（要約）

* shared/ui は「意味のある選択肢」だけを提供する
* margin・配置・幅は wrapper の責務
* 画面固有の都合は wrapper に閉じ込める
* 例外が増えたら shared/ui への昇格を検討する

---

## 10. まとめ

* shared/ui は壊れにくく、強く保つ
* wrapper は柔軟で、都合を吸収する
* 両者を分けることで、CDDとチーム開発が成立する

このルールを守れば、

* デザインが崩れない
* 変更理由がコードに残る
* レビューがしやすい
* Storybookが嘘をつかない

という状態を維持できます。

了解です。
では前回ドキュメントに **そのまま追記できる「追加章」**として、

1. Wrapper → shared/ui へ昇格させる判断基準
2. レビュー時チェックリスト（Yes / No）
3. Button / Input / Select 共通の運用テンプレ

を **文章ベース（Markdown意識なし）**でまとめます。

---

# 追加資料①

Wrapper → shared/ui へ昇格させる判断基準

## なぜ「昇格」の基準が必要か

Wrapper パターンは「例外を安全に閉じ込める」ための仕組みです。ただし、同じ Wrapper が増え続けると次の問題が起きます。

* 実質的に「新しい共通UI」が wrapper に散らばる
* どれが標準なのかわからなくなる
* shared/ui の語彙が育たない

そこで、「wrapper に閉じるか」「shared/ui に昇格させるか」の判断基準を明確にします。

---

## 昇格を検討すべきタイミング（YESが多いほど昇格）

以下の質問に答えて判断します。

1. 同じ wrapper が **2画面以上**で使われているか
2. 見た目や挙動に **明確な意味**があるか
   例：

   * 危険操作
   * 主操作
   * 補助操作
3. デザインレビューで
   「これは標準として使いたい」という合意があるか
4. Storybook に載せた時、
   「他でも使ってよさそう」と説明できるか
5. 「この画面だけの都合」と言い切れなくなってきているか

YES が 3つ以上 → shared/ui への昇格を検討する。

---

## 昇格させてはいけないもの（NO即決）

* 特定画面の背景色に合わせただけの調整
* 一時対応・暫定対応
* A/Bテスト用
* margin / 配置 / width だけの違い
* 数値指定（px）でしか説明できない違い

これらは **永続的に wrapper に閉じる**。

---

## 昇格の正しい形

昇格とは「CSSをコピーすること」ではありません。

正しい昇格とは：

* 数値指定をやめる
* 意味を名前にする
* variant / size / tone などの語彙に落とす

例：

* 「paddingを8pxにしたい」→ NG
* 「小さめの補助ボタン」→ size="sm"

---

# 追加資料②

レビュー時チェックリスト（Yes / No）

このチェックリストは、
**PRレビュー時にそのまま読めば判断できる** ことを目的としています。

---

## shared/ui に関するチェック

1. shared/ui に数値指定（px, rem, color code）は入っていないか
2. variant / size は意味で説明できるか
3. margin / layout の責務を持っていないか
4. Storybook に載せたとき、用途が説明できるか
5. 「この画面だけの都合」が混入していないか

1つでも NO があれば、設計を見直す。

---

## Wrapper コンポーネントに関するチェック

1. 画面都合・用途固定・例外であることが名前から分かるか
   例：
   * RegisterButton
   * MapActionButton
2. shared/ui を直接壊していないか
3. 役割が「意味」か「レイアウト」か説明できるか
4. 同じ wrapper が増殖していないか
5. 昇格の可能性をコメント等で検討しているか

---

## NGサイン（即指摘ポイント）

* shared/ui に margin props が追加されている
* padding や color を props で自由指定している
* class を乱用して見た目を調整している
* 「とりあえずここだけ」で shared/ui を修正している

---

# 追加資料③

共通UI（Button / Input / Select）運用テンプレ

## Button の責務テンプレ

Button が責任を持つもの：

* variant（役割）
* size（大きさ）
* loading / disabled
* focus / hover / active の一貫した挙動
* ボタン内部のレイアウト（文字・アイコン）

Button が責任を持たないもの：

* margin
* 配置
* 親との距離
* 画面固有の色・padding

---

## Input の責務テンプレ

Input が責任を持つもの：

* 入力UI（テキスト、数値など）
* エラー表示
* disabled / readonly
* フォーカス・キーボード体験
* a11y

Input が責任を持たないもの：

* 入力値の意味（業務ルール）
* バリデーションロジック
* 入力必須かどうかの判断
* レイアウト（横並び・幅調整）

---

## Select の責務テンプレ

Select が責任を持つもの：

* 選択UI
* option 表示
* disabled / loading
* 選択状態の表示

Select が責任を持たないもの：

* 選択肢の意味
* 初期選択の判断
* 業務ルールによる制御
* 画面都合の並びや幅

---

## Wrapper の責務テンプレ（共通）

Wrapper がやってよいこと：

* 用途を固定する（登録・削除など）
* shared/ui の組み合わせを決める
* 画面都合の見た目を吸収する
* 確認ダイアログなど補助ロジックを持つ

Wrapper がやってはいけないこと：

* ドメインロジックを持つ
* APIを直接呼ぶ
* shared/ui の意味を上書きする

---

# 最終まとめ（チーム共有用・短文）

* shared/ui は「意味のある見た目」だけを提供する
* wrapper は「画面や用途の都合」を閉じ込める
* 例外は wrapper、標準は shared/ui
* 例外が増えたら昇格を検討する
* レビューでは「意味か？例外か？」を必ず問う

---

これで、

* CDDの思想
* shared/ui と wrapper の役割分担
* 実装判断
* レビュー運用

が **一貫した設計ルール**としてチームに共有できます。

次にやるとしたらおすすめは
「このガイドを1枚に要約した“設計チートシート”」か
「PRテンプレ（チェックリスト内蔵）」です。
