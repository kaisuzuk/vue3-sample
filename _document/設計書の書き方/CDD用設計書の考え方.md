# 前提整理（重要）

まず大事な前提です。

* 既存の **1_機能概要 / 2_画面表示 / 3_画面イベント / 4_初期表示** は「業務・画面中心」の設計として **完成度が高い**
* CDDはそれを否定しない
* ただし **実装判断に必要な情報が不足する**

つまり、

> **画面設計書は“何をする画面か”は分かるが
> “どこに書くか・どう分けるか”が分からない**

ここを補うのが「追加すべき設計書」です。

---

# 追加すべき設計書の全体像（まず俯瞰）

最小構成で追加するなら **3点セット**です。

1. 画面構成マップ（コンポーネント分解図）
2. 状態・責務割当設計書（最重要）
3. コンポーネント設計書（Section単位）

余力があれば +α。

4. Store / usecase（composable）関係整理書
5. Storybook対象設計書

---

# ① 画面構成マップ（必須）

## 何のため？

**「この画面は、どのコンポーネントの組み合わせか」**を一瞬で分かるようにするため。

既存の「2_画面表示」は

* UIの見た目
* 項目配置

は分かるが、

* コンポーネントの粒度
* 再利用単位
* 境界

は分かりません。

---

## 何を書く？

文章 or 箇条書きで十分です。

例（イメージ）：

* Page
  * WorkLogCreatePage
* Widget
  * WorkLogEditorWidget（画面全体の親）
* Sections
  * BasicInfoSection（基本情報入力）
  * AmountSection（数量入力）
  * PhotosSection（写真）
  * MemoSection（メモ）
* 共通UI
  * Button
  * TextInput
  * Select

---

## ポイント

* **レイアウト詳細は書かない**
* **責務の粒度を揃える**
* 「この単位で Storybook を書く」が判断できればOK

---

# ② 状態・責務割当設計書（最重要）

## 何のため？

CDDで一番事故るのはここです。

* どこに状態を置くか
* Storeにするか、usecaseにするか
* UIが判断していいか、ダメか

を **先に決め切る**ための設計書です。

---

## 何を書く？

「状態・処理 × 置き場所」の対応表。

例（イメージ）：

* 入力値（作業日・数量・メモ）
  → useWorkLogEdit.form
* UI状態（submitting / touched）
  → useWorkLogEdit.ui
* 表示非表示判定
  → useWorkLogEdit.view
* バリデーション
  → entities/validateWorkLog
* 登録API呼び出し
  → useWorkLogEdit.actions.submit
* 成功時の画面遷移
  → Page

---

## ここが超重要

この設計書があると：

* 「これはStoreじゃない？」論争が起きない
* if文がUIに散らばらない
* レビューで判断基準が一致する

**CDDの心臓部**です。

---

# ③ コンポーネント設計書（Section単位）

## 何のため？

Sectionを「ただのVueファイル」にしないため。

* props が肥大化しない
* APIを呼び始めない
* 勝手に判断ロジックを書かない

ための **契約書**です。

---

## 何を書く？

Sectionごとに以下を明記します。

* 役割（何を表示・入力するか）
* Props（受け取るもの）
* Emits（返すもの）
* 持ってよい状態（UI状態のみ）
* 持ってはいけないもの（API / Store / 業務判断）

---

## 例（イメージ）

AmountSection：

* 役割：数量入力のUI提供
* Props：amount, error, disabled
* Emits：update:amount
* 禁止事項：
  * API呼び出し
  * バリデーション実装
  * 他項目への影響判断

---

# ④ Store / usecase 関係整理書（推奨）

## なぜ必要？

既存設計では、

* Storeが別フォルダ
* 画面との関係が見えにくい

CDDでは、

* Store = 共有・キャッシュ
* usecase = 画面固有の振る舞い

なので、**理由を書かないと必ずStoreが肥大化**します。

---

## 何を書く？

* この画面で使うStore一覧
* それぞれの責務
* なぜusecaseではなくStoreなのか

例：

* useFieldsStore
  * 複数画面で使用
  * キャッシュ価値あり
* useWorkLogEdit
  * 画面固有
  * 画面遷移で破棄したい

---

# ⑤ Storybook対象設計書（推奨）

## なぜ必要？

Storybookを「やる人・やらない人」で分断しないため。

---

## 何を書く？

* Storybook必須
  * shared/ui
  * sections
* 任意
  * wrapper
* 対象外
  * page
  * widget
  * Map本体

---

# 既存4ファイルとの対応関係（再整理）

| 既存設計書    | CDDで補う設計書     |
| -------- | ------------- |
| 1_機能概要   | 変更なし          |
| 2_画面表示   | 画面構成マップ       |
| 3_画面イベント | 状態・責務割当設計書    |
| 4_初期表示   | usecase初期状態定義 |

👉 **置き換えではなく“分解して補強”**

---

# 最小導入プラン（現実解）

1. 既存4ファイルはそのまま
2. 画面ごとに「画面構成マップ＋状態・責務割当」1枚追加
3. Storybook対象Sectionだけ詳細設計

これで **CDDは十分に回ります**。

---

## 一文まとめ（チーム向け）

* 画面設計書は残す
* CDDは「どこに書くか」を決める設計書を足す
* 一番重要なのは「状態・責務割当」
* Section設計は契約書

---

次に進むなら、

* **この5種類の設計書のテンプレ（コピペ用）**
* 既存画面1つを題材に「今の設計書 → CDD対応設計書」への変換例

どちらを出しますか？
